<html>
<head>
	<meta name="mobile-web-app-capable" content="yes">
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <title>PiRobot</title>
    <script type="text/javascript" src="/webiopi.js"></script>
     <script type="text/javascript">
        webiopi().ready(function() {

			var button, conteneur ;			
			conteneur = $("#togglescam")
			
			// create a "SWITCH" labeled button for GPIO 26
			button = webiopi().createGPIOButton(26, "IR");
			conteneur.append(button); // append button to content div

         // Refresh GPIO buttons
         // pass true to refresh repeatedly of false to refresh once
        webiopi().refreshGPIO(false);
        });
		
		function sleep(ms) {
		return new Promise(resolve => setTimeout(resolve, ms));
		}
	
		async function fctCamOn() {
			var dialog = document.getElementById('startcamdialog');  
			dialog.show();
			
			webiopi().callMacro("camOn");	
			
			await sleep(1000);			
			dialog.close();
			
			window.location.reload(true); 	
		}
		
		async function fctCamOff() {
		    var dialog = document.getElementById('stopcamdialog');  
			dialog.show();
			
			webiopi().callMacro("camOff");	
			
			await sleep(1000);			
			dialog.close();
			
			window.location.reload(true);	
		}
		
		async function fctCamPic() {										
			var dialog = document.getElementById('picdialog');  		
			dialog.show(); 	
			
			webiopi().callMacro("takeaPic");	
			
			await sleep(1000);			
			dialog.close();		
		}
		
					
		function Mot1dirA() {				
			webiopi().digitalWrite(19, 0);
			webiopi().digitalWrite(13, 1);
		}
		
		function Mot1dirB() {				
			webiopi().digitalWrite(13, 0);
			webiopi().digitalWrite(19, 1);
		}
					
		function Mot1speed(speed1) {		
			var Speed1 = speed1/100;
			webiopi().pulseRatio(12, Speed1);
		}
		
		function Mot1stop() {			
			webiopi().digitalWrite(19, 1);
			webiopi().digitalWrite(13, 1);
			webiopi().pulseRatio(12, 1);
		}
			
		function Mot2dirA() {			
			webiopi().digitalWrite(21, 0);
			webiopi().digitalWrite(20, 1);
		}
		
		function Mot2dirB() {			
			webiopi().digitalWrite(20, 0);
			webiopi().digitalWrite(21, 1);
		}
					
		function Mot2speed(speed2) {		
			var Speed2 = speed2/100;
			webiopi().pulseRatio(16, Speed2);
		}
		
		function Mot2stop() {			
			webiopi().digitalWrite(21, 1);
			webiopi().digitalWrite(20, 1);
			webiopi().pulseRatio(16, 1);
		}
		
		
		
		function callMacro_Temp(){
			var arg0 = [0];
            webiopi().callMacro("Temp", arg0, macro_Temp_Callback);
		}

        function macro_Temp_Callback(macro, arg0, data){
           temp = data.split(" ")[0];			
			if (temp <= 80)
				document.getElementById("temp").style.color = "white"
			else
				document.getElementById("temp").style.color = "red"
				
			document.getElementById("temp").innerHTML = "= " + temp + " Â°C";
		}
		
		window.onload = callMacro_Temp;
		var repeat = setInterval ("callMacro_Temp()", 10000);
		
//		async function fctGoogleOn() {
//			//webiopi().callMacro('GoogleOn');
//			var dialog = document.getElementById('startGoogledialog');  		
//			dialog.show();
//			await sleep(1000);
//			dialog.close();
//		}
//		
//		async function fctGoogleOff() {
//			//webiopi().callMacro('GoogleOff');
//			var dialog = document.getElementById('stopGoogledialog');  		
//			dialog.show();
//			await sleep(1000);
//			dialog.close();
//		}
		
	
        </script>
		
        <style type="text/css">
        
		 body {
		overflow	: hidden;
		padding		: 0;
		margin		: 0;
		background  : #BBB url(http://192.168.3.1:8080/?action=stream) no-repeat;
		background-size : cover;
		}				 
				
		 #zone_joystick1 {		 
		position : absolute;
		bottom : 0px;
		left : 0px;
		width : 30%;
		height : 100%;
		border : solid 1px lime;
		}
		 
		 #zone_joystick2 {		 
		position : absolute;
		bottom : 0px;
		right : 0px;
		width : 30%;
		height : 100%;
		border : solid 1px lime;
		}
		
		 #display {		 
		position : absolute;
		bottom : 0px;
		left : 30%;
		right : 30%;
		width : 40%;
		height: 40%;
		}
		
		#actions {
		flex-direction: column;
		justify-content: flex-end;
		align-items: flex-end;
		position : absolute;
		right : 0px;
		bottom : 0px;
		}
		
		#actionsbis {
		flex-direction: column;
		justify-content: flex-end;
		align-items: flex-end;
		position : absolute;
		left : 0px;
		bottom : 0px;
		}
		
		#infos {
		flex-direction: column;
		justify-content: flex-end;
		align-items: flex-end;
		width: 40%;
        height: 30%;
		border-radius: 8px;
		border: 2px solid lime;
		position : absolute;
		left : 0px;
		top : 0px;
		}
		
		.toggles {
		display: flex;		
		}
		
		#tempdiv {
		display: flex;
		justify-content: space_between;
		width: 100%;
        height: 20%;
		}
		
		#thermo {
		width: 60px;
        height: 60px;
        background: url(thermo.png) no-repeat center; 
        background-size : contain;
		}
		
		#temp {
		font-size: 25px;
		font-color: white;
		position : relative;
		left : 0%;
		top : 0px;
		margin-top : 10px;
		}
		
	<!-- 	#btnGoogleOff {
		width: 80px;
        height: 45px;
		margin: 10px 10px 10px 5px;
		border-radius: 8px;
		border: 2px solid #333333;
        background: url(GoogleOff.png) no-repeat center; 
        background-size : contain;		
		}			
		 #btnCamOff:active {
		background-color: #2EFE2E;
		}		
		 #btnCamOff:focus {
		}
		
		 #btnGoogleOn {
		width: 80px;
        height: 45px;
		margin: 10px 5px 10px 10px;
		border-radius: 8px;
		border: 2px solid #333333;
        background: url(GoogleOn.png) no-repeat center; 
        background-size : contain;			
		}	
		 #btnCamOn:active {
		background-color: #2EFE2E;
		}		
		 #btnCamOn:focus {
		} -->
		
		
		 #btnCamPic {
		width: 80px;
        height: 45px;
		margin: 10px 5px 10px 10px;
		border-radius: 8px;
		border: 2px solid #333333;
        background: url(pic.png) no-repeat center; 
        background-size : contain;
		}					
		 #btnCamPic:active {
		background-color: #2EFE2E;
		}		
		 #btnCamPic:focus {
		}
		
		 #btnCamOff {
		width: 80px;
        height: 45px;
		margin: 10px 10px 10px 5px;
		border-radius: 8px;
		border: 2px solid #333333;
        background: url(stop.png) no-repeat center; 
        background-size : contain;		
		}			
		 #btnCamOff:active {
		background-color: #2EFE2E;
		}		
		 #btnCamOff:focus {
		}
		
		 #btnCamOn {
		width: 80px;
        height: 45px;
		margin: 10px 5px 10px 10px;
		border-radius: 8px;
		border: 2px solid #333333;
        background: url(play.png) no-repeat center; 
        background-size : contain;			
		}	
		 #btnCamOn:active {
		background-color: #2EFE2E;
		}		
		 #btnCamOn:focus {
		}
		
		 button {
		width: 80px;
        height: 45px;
		margin: 10px 10px 10px 5px;
		border-radius: 8px;
		border: 2px solid #333333;
		}		 
		 button:focus {
		}				
		 #gpio26.HIGH {		
		background-color: transparent;
		}	
		 #gpio26.LOW {	
		background-color: #2EFE2E;
		}	


		#picdialog {
		background: url(pic.png) no-repeat center; 
        background-size : contain;
        border: none;
		position : absolute;
		 top : 0%;
		 width : 20%;
		 height: 20%;
		}		
		
		#startcamdialog {
		background: url(play.png) no-repeat center; 
        background-size : contain;
        border: none;
		position : absolute;
		 top : 0%;
		 width : 30%;
		 height: 30%;
		}	
		
		#stopcamdialog {
		background: url(stop.png) no-repeat center; 
        background-size : contain;
        border: none;
		position : absolute;
		 top : 0%;
		 width : 30%;
		 height: 30%;
		}	
		
		#startGoogledialog {
		background: url(GoogleOn.png) no-repeat center; 
        background-size : contain;
        border: none;
		position : absolute;
		 top : 0%;
		 width : 30%;
		 height: 30%;
		}	
		
		#stopGoogledialog {
		background: url(GoogleOff.png) no-repeat center; 
        background-size : contain;
        border: none;
		position : absolute;
		 top : 0%;
		 width : 30%;
		 height: 30%;
		}	
		
        </style>
</head>
<body>
       

	   
	   
<div id="display">

<dialog id="picdialog">   
</dialog>  
<dialog id="startcamdialog">   
</dialog> 
<dialog id="stopcamdialog">   
</dialog>
<!-- <dialog id="startGoogledialog">   
</dialog> 
<dialog id="stopGoogledialog">   
</dialog> -->



<div id="infos">
<div id="tempdiv">
<img id="thermo"></button><div id="temp"></div>
</div>
</div>

<div id="actionsbis">
<div id="togglesbis" class="toggles">
<!-- <button type="button" id="btnGoogleOn" onclick="fctGoogleOn()">
<button type="button" id="btnGoogleOff" onclick="fctGoogleOff()"> -->
</div>
</div>

<div id="actions">
<div id="togglescam" class="toggles">
<button type="button" id="btnCamPic" onclick="fctCamPic()">
</div>
<div class="toggles">
<button type="button" id="btnCamOn" onclick="fctCamOn()">
<button type="button" id="btnCamOff" onclick="fctCamOff()">
</div>
</div>
</div>

<div id="zone_joystick1"></div>
<div id="zone_joystick2"></div>

<script src="nipplejs.min.js"></script>
<script>
// premier Joystick
	var joystick1 = nipplejs.create({
			zone: document.getElementById('zone_joystick1'),
			mode: 'static',
			size: 250,
			position: {left: '50%', top: '70%'},
			color: 'lime',
			threshold: 0.0
	});
		
	joystick1.on('plain:up', function (evt, data) 
	{		
		// set forward 
		Mot1dirA();				
	});
	
	joystick1.on('plain:down', function (evt, data) 
	{	
		// set backward 
		Mot1dirB();
	});	
	
	joystick1.on('move', function (evt, data) 
	{		
		// set speed 
		var speed1 = data.distance;	
		Mot1speed(speed1);			
	});
									
	joystick1.on('end', function (evt, data) 
	{	
		// set PWM to 0	
		Mot1stop();	
	});      
 
	
// second Joystick	
	var joystick2 = nipplejs.create({
			zone: document.getElementById('zone_joystick2'),
			mode: 'static',
			size: 250,
			position: {left: '50%', top: '70%'},
			color: 'lime',
			threshold: 0.0
	});	
			
	joystick2.on('plain:up', function (evt, data) 
	{	
		//set forward
		Mot2dirA();	
	});
	
	joystick2.on('plain:down', function (evt, data) 
	{		
		// set backward 
		Mot2dirB();
	});	
	
	joystick2.on('move', function (evt, data) 
	{		
		// set speed 
		var speed2 = data.distance;	
		Mot2speed(speed2);			
	});
									
	joystick2.on('end', function (evt, data) 
	{	
		// set PWM to 0
		Mot2stop();	
	});  
</script>


</body>
</html>

