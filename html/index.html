<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
	<meta name="mobile-web-app-capable" content="yes">
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <title>PiRobot</title>
    <script type="text/javascript" src="/webiopi.js"></script>
     <script type="text/javascript">
        webiopi().ready(function() {

			var button, conteneur;			
			conteneur = $("#togglescam")
			
			// create a "SWITCH" labeled button for GPIO 26
			button = webiopi().createGPIOButton(26, "IR");
			conteneur.append(button); // append button to content div
				

         // Refresh GPIO buttons
         // pass true to refresh repeatedly of false to refresh once
        webiopi().refreshGPIO(true);
        });
		
		function sleep(ms) {
		return new Promise(resolve => setTimeout(resolve, ms));
		}
	
		async function fctCamOn() {
			var dialog = document.getElementById('startcamdialog');  
			dialog.show();
			
			webiopi().callMacro("camOn");	
			
			await sleep(1000);			
			dialog.close();
			
			window.location.reload(true); 	
		}
		
		async function fctCamOff() {
		    var dialog = document.getElementById('stopcamdialog');  
			dialog.show();
			
			webiopi().callMacro("camOff");	
			
			await sleep(1000);			
			dialog.close();
			
			window.location.reload(true);	
		}
		
		async function fctCamPic() {										
			var dialog = document.getElementById('picdialog');  		
			dialog.show(); 	
			
			webiopi().callMacro("takeaPic");	
			
			await sleep(1000);			
			dialog.close();		
		}
		
		
        </script>
        <style type="text/css">
        
		body {
		overflow	: hidden;
		padding		: 0;
		margin		: 0;
		background  : #BBB url(http://192.168.3.1:8080/?action=stream) no-repeat;
		background-size : cover;
		}				 
				
		 #zone_joystick1 {
		 
		 position : absolute;
		 bottom : 0px;
		 left : 0px;
		 width : 20%;
		 height : 60%;
		 border: 1px solid lime;
		 border-radius: 8px;
		 }
		 
		 #zone_joystick2 {
		 
		 position : absolute;
		 bottom : 0px;
		 right : 0px;
		 width : 20%;
		 height : 60%;
		 border: 1px solid lime;
		 border-radius: 8px;
		 }
		 
		 #result_joystick1 {
		 
		 position : absolute;
		 bottom : 0px;
		 right : 0px;
		 }
		 
		 #result_joystick2 {
		 
		 position : absolute;
		 bottom : 0px;
		 left : 0px;
		 }
		
		 #display {
		 
		 display: flex; 
		 flex-direction: column;
		 justify-content: flex-end;
		 align-items: flex-end;
		 position : absolute;
		 bottom : 0px;
		 left : 30%;
		 right : 30%;
		 width : 40%;
		 height: 40%;
		 border: 1px solid lime;	
		 border-radius: 8px;
		}
		
		.toggles {
		display: flex;		
		}
		
		#btnCamPic {
		width: 80px;
        height: 45px;
		margin: 10px 5px 10px 10px;
		border-radius: 8px;
		border: 2px solid #333333;
        background: url(pic.png) no-repeat center; 
        background-size : contain;
		}
		
		#btnCamOff {
		width: 80px;
        height: 45px;
		margin: 10px 5px 10px 10px;
		border-radius: 8px;
		border: 2px solid #333333;
        background: url(stop.png) no-repeat center; 
        background-size : contain;		
		}
		
		#btnCamOn {
		width: 80px;
        height: 45px;
		margin: 10px 10px 10px 5px;
		border-radius: 8px;
		border: 2px solid #333333;
        background: url(play.png) no-repeat center; 
        background-size : contain;	
		
		}
		
		 button {
		width: 80px;
        height: 45px;
		margin: 10px 10px 10px 5px;
		border-radius: 8px;
		border: 2px solid #333333;
		 }
		
		
		 #gpio26.HIGH {
		
		background-color: transparent;

		}
		
		 #gpio26.LOW {
		
		background-color: #2EFE2E;
		}	


		#picdialog {
		background: url(pic.png) no-repeat center; 
        background-size : contain;
        border: none;
		position : absolute;
		 top : 30%;
		 width : 20%;
		 height: 20%;
		}		
		
		#startcamdialog {
		background: url(play.png) no-repeat center; 
        background-size : contain;
        border: none;
		position : absolute;
		 top : 30%;
		 width : 20%;
		 height: 20%;
		}	
		
		#stopcamdialog {
		background: url(stop.png) no-repeat center; 
        background-size : contain;
        border: none;
		position : absolute;
		 top : 30%;
		 width : 20%;
		 height: 20%;
		}	
		
        </style>
</head>
<body>
       

	   
	   
<div id="display">

<dialog id="picdialog">   
</dialog>  
<dialog id="startcamdialog">   
</dialog> 
<dialog id="stopcamdialog">   
</dialog> 

<div id="togglescam" class="toggles">
<button type="button" id="btnCamPic" onclick="fctCamPic()">
</div>
<div class="toggles">
<button type="button" id="btnCamOff" onclick="fctCamOff()">
<button type="button" id="btnCamOn" onclick="fctCamOn()">
</div>
</div>

<div id="zone_joystick1"><div id="result_joystick1"></div></div>
<div id="zone_joystick2"><div id="result_joystick2"></div></div>

<script src="nipplejs.min.js"></script>
<script>
	// premier Joystick
	var joystick1 = nipplejs.create({
			zone: document.getElementById('zone_joystick1'),
			mode: 'static',
			size: 200,
			position: {left: '50%', top: '50%'},
			color: 'lime'
	});

	joystick1.on('plain:up', function (evt, data) 
	{
		joystick1.on('start move', function (evt, data) 
	    {			

			
			var position1 = data.distance;						
			var outputEl	= document.getElementById('result_joystick1');				
			outputEl.innerHTML	= ' dy 1 : ' + position1; 			
		})
	});
	
	joystick1.on('plain:down', function (evt, data) 
	{
		joystick1.on('start move', function (evt, data) 
	    {	

		
	 		var position1 = - data.distance;						
			var outputEl	= document.getElementById('result_joystick1');				
			outputEl.innerHTML	= ' dy 1 : ' + position1; 			
		})
	});
									
	joystick1.on('end', function (evt, data) 
	{

	
		var position1 = 0;
		var outputEl	= document.getElementById('result_joystick1');				
		outputEl.innerHTML	= ' dy 1 : ' + position1;		
	});      
 
	

	// second Joystick	
	var joystick2 = nipplejs.create({
			zone: document.getElementById('zone_joystick2'),
			mode: 'static',
			size: 200,
			position: {left: '50%', top: '50%'},
			color: 'lime'
	});
	
    joystick2.on('plain:up', function (evt, data) 
	{
		joystick2.on('start move', function (evt, data) 
	    {		
		
	 		var position2 = data.distance;						
			var outputE2	= document.getElementById('result_joystick2');				
			outputE2.innerHTML	= ' dy 2 : ' + position2; 			
		})
	});
	
	joystick2.on('plain:down', function (evt, data) 
	{
		joystick2.on('start move', function (evt, data) 
	    {			
	 		var position2 = - data.distance;						
			var outputE2	= document.getElementById('result_joystick2');				
			outputE2.innerHTML	= ' dy 2 : ' + position2; 			
		})
	});
		
	joystick2.on('end', function (evt, data) 
	{
		var position2 = 0;
		var outputE2	= document.getElementById('result_joystick2');				
		outputE2.innerHTML	= ' dy 2 : ' + position2;		
	});  
	
</script>


</body>
</html>

