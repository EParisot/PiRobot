<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
	<meta name="mobile-web-app-capable" content="yes">
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <title>PiRobot</title>
    <script type="text/javascript" src="/webiopi.js"></script>
     <script type="text/javascript">
        webiopi().ready(function() {

			var button, conteneur;			
			conteneur = $("#togglescam")
			
			// create a "SWITCH" labeled button for GPIO 26
			button = webiopi().createGPIOButton(26, "IR");
			conteneur.append(button); // append button to content div

         // Refresh GPIO buttons
         // pass true to refresh repeatedly of false to refresh once
        webiopi().refreshGPIO(true);
        });
		
		function sleep(ms) {
		return new Promise(resolve => setTimeout(resolve, ms));
		}
	
		async function fctCamOn() {
			var dialog = document.getElementById('startcamdialog');  
			dialog.show();
			
			webiopi().callMacro("camOn");	
			
			await sleep(1000);			
			dialog.close();
			
			window.location.reload(true); 	
		}
		
		async function fctCamOff() {
		    var dialog = document.getElementById('stopcamdialog');  
			dialog.show();
			
			webiopi().callMacro("camOff");	
			
			await sleep(1000);			
			dialog.close();
			
			window.location.reload(true);	
		}
		
		async function fctCamPic() {										
			var dialog = document.getElementById('picdialog');  		
			dialog.show(); 	
			
			webiopi().callMacro("takeaPic");	
			
			await sleep(1000);			
			dialog.close();		
		}
		
				
		var DIR1;	
		function Mot1dir(dir) {			
		DIR1 = dir;		
		}
					
		function Mot1speed(speed1) {		
		var Speed1 = speed1/100;
		webiopi().pulseRatio(DIR1, Speed1);
		}
		
		var DIR2;	
		function Mot2dir(dir) {			
		DIR2 = dir;		
		}
					
		function Mot2speed(speed2) {		
		var Speed2 = speed2/100;
		webiopi().pulseRatio(DIR2, Speed2);
		}
	
        </script>
		
        <style type="text/css">
        
		 body {
		overflow	: hidden;
		padding		: 0;
		margin		: 0;
		background  : #BBB url(http://192.168.3.1:8080/?action=stream) no-repeat;
		background-size : cover;
		}				 
				
		 #zone_joystick1 {		 
		position : absolute;
		bottom : 0px;
		left : 0px;
		width : 30%;
		height : 100%;
		}
		 
		 #zone_joystick2 {		 
		position : absolute;
		bottom : 0px;
		right : 0px;
		width : 30%;
		height : 100%;
		}
		
		 #display {		 
		display: flex; 
		flex-direction: column;
		justify-content: flex-end;
		align-items: flex-end;
		position : absolute;
		bottom : 0px;
		left : 30%;
		right : 30%;
		width : 40%;
		height: 40%;
		}
		
		.toggles {
		display: flex;		
		}
		
		 #btnCamPic {
		width: 80px;
        height: 45px;
		margin: 10px 5px 10px 10px;
		border-radius: 8px;
		border: 2px solid #333333;
        background: url(pic.png) no-repeat center; 
        background-size : contain;
		}					
		 #btnCamPic:active {
		background-color: #2EFE2E;
		}		
		 #btnCamPic:focus {
		}
		
		 #btnCamOff {
		width: 80px;
        height: 45px;
		margin: 10px 5px 10px 10px;
		border-radius: 8px;
		border: 2px solid #333333;
        background: url(stop.png) no-repeat center; 
        background-size : contain;		
		}			
		 #btnCamOff:active {
		background-color: #2EFE2E;
		}		
		 #btnCamOff:focus {
		}
		
		 #btnCamOn {
		width: 80px;
        height: 45px;
		margin: 10px 10px 10px 5px;
		border-radius: 8px;
		border: 2px solid #333333;
        background: url(play.png) no-repeat center; 
        background-size : contain;			
		}	
		 #btnCamOn:active {
		background-color: #2EFE2E;
		}		
		 #btnCamOn:focus {
		}

		
		 button {
		width: 80px;
        height: 45px;
		margin: 10px 10px 10px 5px;
		border-radius: 8px;
		border: 2px solid #333333;
		}		 
		 button:focus {
		}				
		 #gpio26.HIGH {		
		background-color: transparent;
		}	
		 #gpio26.LOW {	
		background-color: #2EFE2E;
		}	


		#picdialog {
		background: url(pic.png) no-repeat center; 
        background-size : contain;
        border: none;
		position : absolute;
		 top : 0%;
		 width : 20%;
		 height: 20%;
		}		
		
		#startcamdialog {
		background: url(play.png) no-repeat center; 
        background-size : contain;
        border: none;
		position : absolute;
		 top : 0%;
		 width : 30%;
		 height: 30%;
		}	
		
		#stopcamdialog {
		background: url(stop.png) no-repeat center; 
        background-size : contain;
        border: none;
		position : absolute;
		 top : 0%;
		 width : 30%;
		 height: 30%;
		}	
		
        </style>
</head>
<body>
       

	   
	   
<div id="display">

<dialog id="picdialog">   
</dialog>  
<dialog id="startcamdialog">   
</dialog> 
<dialog id="stopcamdialog">   
</dialog> 

<div id="togglescam" class="toggles">
<button type="button" id="btnCamPic" onclick="fctCamPic()">
</div>
<div class="toggles">
<button type="button" id="btnCamOff" onclick="fctCamOff()">
<button type="button" id="btnCamOn" onclick="fctCamOn()">
</div>
</div>

<div id="zone_joystick1"></div>
<div id="zone_joystick2"></div>

<script src="nipplejs.min.js"></script>
<script>
// premier Joystick
	var joystick1 = nipplejs.create({
			zone: document.getElementById('zone_joystick1'),
			mode: 'static',
			size: 300,
			position: {left: '50%', top: '50%'},
			color: 'lime',
			threshold: 0.0
	});
		
	joystick1.on('plain:up', function (evt, data) 
	{	
		Mot1dir(6);	
		Mot1speed(0);			
		// set forward
		Mot1dir(5);	
	});
	
	joystick1.on('plain:down', function (evt, data) 
	{			
		Mot1dir(5);	
		Mot1speed(0);	
		// set backward 
		Mot1dir(6);
	});	
	
	joystick1.on('move', function (evt, data) 
	{		
		// set speed 
		var speed1 = data.distance;	
		Mot1speed(speed1);			
	});
									
	joystick1.on('end', function (evt, data) 
	{	
		// set PWM to 0
		var speed1 = 0;	
		Mot1speed(speed1);	
	});      
 
	
// second Joystick	
	var joystick2 = nipplejs.create({
			zone: document.getElementById('zone_joystick2'),
			mode: 'static',
			size: 300,
			position: {left: '50%', top: '50%'},
			color: 'lime',
			threshold: 0.0
	});	
			
	joystick2.on('plain:up', function (evt, data) 
	{	
		Mot2dir(13);	
		Mot2speed(0);			
		// set forward
		Mot2dir(12);	
	});
	
	joystick2.on('plain:down', function (evt, data) 
	{			
		Mot2dir(12);	
		Mot2speed(0);	
		// set backward 
		Mot2dir(13);
	});	
	
	joystick2.on('move', function (evt, data) 
	{		
		// set speed 
		var speed2 = data.distance;	
		Mot2speed(speed2);			
	});
									
	joystick2.on('end', function (evt, data) 
	{	
		// set PWM to 0
		var speed2 = 0;	
		Mot2speed(speed2);	
	});  
</script>


</body>
</html>

